generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                 String        @id @default(uuid()) @map("id") @db.Uuid
  email              String?       @unique
  first_name         String?
  last_name          String?
  role               Role          @default(PARENT)
  phoneNumber        String?
  address            String?
  isActive           Boolean       @default(true)
  subVillage         SubVillage?
  createdBy          String?       @db.Uuid
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @default(now()) @updatedAt
  children           Child[]       @relation("ParentChildren")
  registeredChildren Child[]       @relation("CadreRegistered")
  galleries          Gallery[]
  measurements       Measurement[]
  recipes            Recipe[]
  creator            User?         @relation("UserCreator", fields: [createdBy], references: [id])
  createdUsers       User[]        @relation("UserCreator")
  Article            Article[]

  @@index([email])
  @@index([role])
  @@index([subVillage])
  @@map("profiles")
}

model Child {
  id             String        @id @default(cuid())
  registrationNo String        @unique
  name           String
  gender         Gender
  dateOfBirth    DateTime
  birthHeight    Float?
  subVillage     SubVillage
  parentId       String        @db.Uuid
  registeredById String        @db.Uuid
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  parent         User          @relation("ParentChildren", fields: [parentId], references: [id])
  registeredBy   User          @relation("CadreRegistered", fields: [registeredById], references: [id])
  measurements   Measurement[]

  @@index([parentId])
  @@index([registeredById])
  @@index([subVillage])
}

model Measurement {
  id                 String         @id @default(cuid())
  childId            String
  measurementDate    DateTime
  ageInMonths        Int
  weight             Float
  height             Float
  heightForAgeZScore Float
  stuntingStatus     StuntingStatus
  measuredById       String         @db.Uuid
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  child              Child          @relation(fields: [childId], references: [id], onDelete: Cascade)
  measuredBy         User           @relation(fields: [measuredById], references: [id])

  @@unique([childId, measurementDate])
  @@index([childId])
  @@index([measurementDate])
  @@index([stuntingStatus])
}

model Recipe {
  id           String       @id @default(cuid())
  name         String
  category     FoodCategory
  youtubeUrl   String?
  description  String
  ingredients  String[]
  spices       String[]
  groundSpices String[]
  createdById  String       @db.Uuid
  isPublished  Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  createdBy    User         @relation(fields: [createdById], references: [id])

  @@index([category])
  @@index([createdById])
}

model Gallery {
  id          String   @id @default(cuid())
  title       String
  description String
  imageUrl    String
  createdById String   @db.Uuid
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   User     @relation(fields: [createdById], references: [id])

  @@index([createdById])
}

// Enhanced Article model
model Article {
  id          String          @id @default(cuid())
  title       String
  slug        String          @unique // Should be unique for SEO
  imageUrl    String
  category    ArticleCategory
  description String          @db.Text
  content     String          @db.Text // Full article content

  // SEO and metadata
  metaTitle       String?
  metaDescription String?

  // Publishing controls
  isPublished Boolean @default(false) // Start as draft
  isDraft     Boolean @default(true)

  // Optional featured article
  isFeatured Boolean @default(false)

  // View tracking
  viewCount Int @default(0)

  // Scheduling
  publishedAt DateTime?

  // Relations
  createdById String @db.Uuid
  createdBy   User   @relation(fields: [createdById], references: [id])

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Indexes for performance
  @@index([createdById])
  @@index([category])
  @@index([isPublished])
  @@index([isFeatured])
  @@index([publishedAt])
  @@index([slug])
}

model Article {
  id              String          @id
  title           String
  slug            String          @unique
  imageUrl        String
  category        ArticleCategory
  description     String
  content         String
  metaTitle       String?
  metaDescription String?
  isPublished     Boolean         @default(false)
  isDraft         Boolean         @default(true)
  isFeatured      Boolean         @default(false)
  viewCount       Int             @default(0)
  publishedAt     DateTime?
  createdById     String          @db.Uuid
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  profiles        profiles        @relation(fields: [createdById], references: [id])

  @@index([category])
  @@index([createdById])
  @@index([isFeatured])
  @@index([isPublished])
  @@index([publishedAt])
  @@index([slug])
  @@schema("public")
}

model Child {
  id                                      String        @id
  registrationNo                          String        @unique
  name                                    String
  gender                                  Gender
  dateOfBirth                             DateTime
  birthHeight                             Float?
  subVillage                              SubVillage
  parentId                                String        @db.Uuid
  registeredById                          String        @db.Uuid
  isActive                                Boolean       @default(true)
  createdAt                               DateTime      @default(now())
  updatedAt                               DateTime
  profiles_Child_parentIdToprofiles       profiles      @relation("Child_parentIdToprofiles", fields: [parentId], references: [id])
  profiles_Child_registeredByIdToprofiles profiles      @relation("Child_registeredByIdToprofiles", fields: [registeredById], references: [id])
  Measurement                             Measurement[]

  @@index([parentId])
  @@index([registeredById])
  @@index([subVillage])
  @@schema("public")
}

model Gallery {
  id          String   @id
  title       String
  description String
  imageUrl    String
  createdById String   @db.Uuid
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  profiles    profiles @relation(fields: [createdById], references: [id])

  @@index([createdById])
  @@schema("public")
}

model Measurement {
  id                 String         @id
  childId            String
  measurementDate    DateTime
  ageInMonths        Int
  weight             Float
  height             Float
  heightForAgeZScore Float
  stuntingStatus     StuntingStatus
  measuredById       String         @db.Uuid
  createdAt          DateTime       @default(now())
  updatedAt          DateTime
  Child              Child          @relation(fields: [childId], references: [id], onDelete: Cascade)
  profiles           profiles       @relation(fields: [measuredById], references: [id])

  @@unique([childId, measurementDate])
  @@index([childId])
  @@index([measurementDate])
  @@index([stuntingStatus])
  @@schema("public")
}

model Recipe {
  id           String       @id
  name         String
  category     FoodCategory
  youtubeUrl   String?
  description  String
  ingredients  String[]
  spices       String[]
  groundSpices String[]
  createdById  String       @db.Uuid
  isPublished  Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  profiles     profiles     @relation(fields: [createdById], references: [id])

  @@index([category])
  @@index([createdById])
  @@schema("public")
}

enum Role {
  ADMIN
  CADRE
  PARENT
}

enum SubVillage {
  SUB_VILLAGE_1
  SUB_VILLAGE_2
  SUB_VILLAGE_3
  SUB_VILLAGE_4
  SUB_VILLAGE_5
  SUB_VILLAGE_6
  SUB_VILLAGE_7
  SUB_VILLAGE_8
}

enum Gender {
  MALE
  FEMALE
}

enum FoodCategory {
  AGE_6_11
  AGE_12_23
  AGE_24_35
  AGE_36_47
  AGE_48_60
}

enum StuntingStatus {
  NORMAL
  STUNTING
  STUNTING_BERAT
}

enum ArticleCategory {
  NUTRISI
  KESEHATAN
  PARENTING
  RESEP
  BERITA
  TIPS
}
